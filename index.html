<!DOCTYPE html>
<html lang="he">
<!-- Set the document language to Hebrew -->

<head>
  <!-- Start of the head section -->
  <meta charset="UTF-8">
  <!-- Specifies the character encoding for the document -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Configures viewport for responsiveness -->
  <title>כניסה | בדיקת נוכחות</title>
  <!-- Sets the title of the page, translated to Hebrew and updated -->
  <style>
    /* Styles for the login/registration page */
    body {
      font-family: Arial, sans-serif;
      /* Sets a generic sans-serif font, with Arial as a specific option */
      margin: 0;
      /* Remove default body margin */
      padding: 0;
      /* Remove default body padding */
      background-color: #f4f4f4;
      /* Sets a light gray background color*/
      direction: rtl;
      /* Sets the default text direction to right-to-left for Hebrew */
      display: flex;
      /* Use flexbox for centering */
      justify-content: center;
      /* Center content horizontally */
      align-items: center;
      /* Center content vertically */
      min-height: 100vh;
      /* Ensure minimum height is the full viewport height */
    }

    .container {
      max-width: 400px;
      /* Sets a maximum width for the content */
      margin: 20px auto;
      /* Centers the container horizontally with top/bottom margin */
      padding: 20px;
      /* Adds padding inside the container */
      background-color: #fff;
      /* Sets a white background color */
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      /* Adds a subtle box shadow */
      border-radius: 8px;
      /* Rounds the corners of the container */
      text-align: center;
      /* Center text within the container */
    }

    h1 {
      margin-bottom: 20px;
      /* Adds space below the heading */
    }

    .form-group {
      margin-bottom: 15px;
      /* Adds space below each form group */
      text-align: right;
      /* Align labels to the right for Hebrew */
    }

    label {
      display: block;
      /* Make labels block-level elements */
      margin-bottom: 5px;
      /* Adds space below labels */
      font-weight: bold;
      /* Make label text bold */
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      /* Make input fields take full width */
      padding: 10px;
      /* Adds padding inside input fields */
      border: 1px solid #ccc;
      /* Adds a light gray border */
      border-radius: 4px;
      /* Rounds the corners of input fields */
      box-sizing: border-box;
      /* Include padding and border in the element's total width and height */
    }

    button {
      width: 100%;
      /* Make buttons take full width */
      padding: 10px;
      /* Adds padding inside buttons */
      background-color: #4CAF50;
      /* Sets a green background color */
      color: white;
      /* Sets white text color */
      border: none;
      /* Removes the default border */
      border-radius: 4px;
      /* Rounds the corners of buttons */
      cursor: pointer;
      /* Change cursor to pointer on hover */
      font-size: 16px;
      /* Sets the font size */
    }

    button:hover {
      background-color: #45a049;
      /* Darker green on hover */
    }

    .error-message {
      color: red;
      /* Sets error message text color to red */
      margin-top: 10px;
      /* Adds space above error message */
    }

    .toggle-form {
      margin-top: 20px;
      /* Adds space above the toggle link */
      cursor: pointer;
      /* Change cursor to pointer on hover */
      color: blue;
      /* Sets link color to blue */
      text-decoration: underline;
      /* Underlines the link */
    }

    /* Styles for the calendar */
    body {
      font-family: Arial, sans-serif;
      /* Sets a generic sans-serif font, with Arial as a specific option */
    }

    .container {
      max-width: 800px;
      /* Sets a maximum width for the content */
    }

    .calendar {
      display: grid;
      /* Use grid layout */
      grid-template-columns: repeat(7, 1fr);
      /* Creates 7 equal-width columns for days */
      gap: 10px;
      /* Sets the gap between grid items */
    }

    .day {
      border: 1px solid #ddd;
      /* Adds a light gray border to each day */
      padding: 10px;
      /* Adds padding inside each day */
      text-align: center;
      /* Centers the text within each day */
      background-color: #f9f9f9;
      /* Light gray background for days */
    }

    .day-header {
      font-weight: bold;
      /* Make day header text bold */
      margin-bottom: 5px;
      /* Add space below header */
      background-color: #eee;
      /* Slightly darker background for headers */
      padding: 5px;
      /* Padding for the day headers */
    }

    .name-list {
      margin-top: 10px;
      /* Adds space above the name list */
      text-align: right;
      /* Align names to the right for Hebrew */
    }

    .name {
      padding: 2px 5px;
      /* Adds padding around each name */
      margin: 2px 0;
      /* Margin between names */
      display: inline-block;
      /* Displays names inline-block */
      border-radius: 3px;
      /* Slightly rounded corners for name tags */
      cursor: pointer;
      /* Change cursor to pointer on hover */
    }

    .on-base {
      background-color: green;
      /* Green background for "on base" */
    }

    .request {
      background-color: yellow;
      /* Yellow background for "request" */
    }

    .sick {
      background-color: red;
      /* Red background for "sick" */
      color: white;
      /* White text for better contrast on Red */
    }

    .totals {
      margin-top: 10px;
      /* Adds space above the totals */
      font-weight: bold;
      /* Bold text for totals */
    }

    /* Style for the name management section */
    .name-management {
      margin-bottom: 20px;
      /* Adds bottom margin */
      border: 1px solid #ddd;
      /* Adds border */
      padding: 10px;
      /* Adds padding */
      background-color: #f9f9f9;
      /* Light gray background */
    }

    /* Style for individual name inputs */
    .name-input {
      margin-right: 5px;
      /* Adds right margin */
      padding: 5px;
      /* Adds padding */
      border: 1px solid #ccc;
      /* Adds border */
      border-radius: 4px;
      /* Rounded corners */
    }

    /* Responsive adjustments */
    @media (max-width: 600px) {
      .calendar {
        grid-template-columns: repeat(1, 1fr);
        /* Stack days vertically on small screens */
      }
    }
  </style>
  <!-- End of the style section -->
</head>

<body>
  <!-- Start of the body section -->

  <!-- Login/Registration Container -->
  <div class="container" id="authContainer">
    <!-- Container for login/registration forms -->
    <h1>כניסה</h1>
    <!-- Main heading for login -->

    <!-- Login Form -->
    <form id="loginForm" class="form">
      <!-- Login form -->
      <div class="form-group">
        <!-- Form group for username -->
        <label for="loginUsername">שם משתמש:</label>
        <!-- Label for username input -->
        <input type="text" id="loginUsername" required>
        <!-- Username input field -->
      </div>
      <div class="form-group">
        <!-- Form group for password -->
        <label for="loginPassword">סיסמה:</label>
        <!-- Label for password input -->
        <input type="password" id="loginPassword" required>
        <!-- Password input field -->
      </div>
      <button type="submit">התחבר</button>
      <!-- Login button -->
      <p class="error-message" id="loginError"></p>
      <!-- Error message display for login -->
    </form>

    <!-- Registration Form -->
    <form id="registerForm" class="form" style="display: none;">
      <!-- Registration form, initially hidden -->
      <div class="form-group">
        <!-- Form group for username -->
        <label for="registerUsername">שם משתמש:</label>
        <!-- Label for username input -->
        <input type="text" id="registerUsername" required>
        <!-- Username input field -->
      </div>
      <div class="form-group">
        <!-- Form group for password -->
        <label for="registerPassword">סיסמה:</label>
        <!-- Label for password input -->
        <input type="password" id="registerPassword" required>
        <!-- Password input field -->
      </div>
      <button type="submit">הרשם</button>
      <!-- Register button -->
      <p class="error-message" id="registerError"></p>
      <!-- Error message display for registration -->
    </form>

    <p class="toggle-form" id="toggleForm">אין לך חשבון? הירשם</p>
    <!-- Link to toggle between login and registration forms -->
  </div>

  <!-- Main container for the content -->
  <div class="container" id="calendarContainer" style="display: none;">
    <!-- Main container for the content -->
    <h1>בדיקת נוכחות</h1>
    <!-- Main heading, translated to Hebrew and updated-->

    <!-- Name Management Section -->
    <div class="name-management">
      <!-- Container for name management -->
      <label for="namesInput">ניהול שמות (מופרדים בפסיק):</label>
      <!-- Label for names input, translated to Hebrew -->
      <input type="text" id="namesInput" placeholder="דוד, רות, משה">
      <!-- Text input for names, with Hebrew placeholder -->
      <button onclick="updateNames()">עדכן שמות</button>
      <!-- Button to update the names, translated to Hebrew -->
    </div>

    <div class="calendar" id="calendar">
      <!-- Calendar container -->
      <!-- Calendar days will be dynamically added here -->
    </div>
  </div>

  <script>
    // Get form elements
    const loginForm = document.getElementById('loginForm'); // Get the login form element
    const registerForm = document.getElementById('registerForm'); // Get the registration form element
    const toggleFormLink = document.getElementById('toggleForm'); // Get the link to toggle between forms
    const loginError = document.getElementById('loginError'); // Get the error message element for login
    const registerError = document.getElementById('registerError'); // Get the error message element for registration
    const authContainer = document.getElementById('authContainer');  // Container for login and registration forms
    const calendarContainer = document.getElementById('calendarContainer'); // Get calendar container

    // Function to toggle between login and registration forms
    function toggleForm() {
      if (loginForm.style.display === 'none') { // Check if login form is hidden
        loginForm.style.display = 'block'; // Show login form
        registerForm.style.display = 'none'; // Hide registration form
        toggleFormLink.textContent = 'אין לך חשבון? הירשם'; // Update toggle link text
      } else {
        loginForm.style.display = 'none'; // Hide login form
        registerForm.style.display = 'block'; // Show registration form
        toggleFormLink.textContent = 'כבר יש לך חשבון? התחבר'; // Update toggle link text
      }
      loginError.textContent = ''; // Clear login error message
      registerError.textContent = ''; // Clear registration error message
    }

    // Add event listener to toggle form link
    toggleFormLink.addEventListener('click', toggleForm); // Call toggleForm function when link is clicked

    // Function to handle registration
    function handleRegistration(event) {
      event.preventDefault(); // Prevent default form submission

      const username = document.getElementById('registerUsername').value; // Get username from input
      const password = document.getElementById('registerPassword').value; // Get password from input

      // Simple validation (you should implement more robust validation)
      if (!username || !password) { // Check if username or password is empty
        registerError.textContent = 'יש למלא את כל השדות'; // Display error message
        return; // Exit function if validation fails
      }

      // Store user data in localStorage, including an initial calendar data object
      localStorage.setItem(username, JSON.stringify({ password: password, userData: { names: ["אליס", "בוב", "צ'רלי"], calendarData: {} } })); // Store username and password with initial data
      registerError.textContent = 'ההרשמה הצליחה! כעת ניתן להתחבר.'; // Display success message
      toggleForm(); // Switch to the login form
    }

    // Function to handle login
    function handleLogin(event) {
      event.preventDefault(); // Prevent default form submission

      const username = document.getElementById('loginUsername').value; // Get username from input
      const password = document.getElementById('loginPassword').value; // Get password from input

      // Retrieve user data from localStorage
      const storedData = localStorage.getItem(username); // Get stored data for the username

      if (storedData) { // If stored data exists
        const parsedData = JSON.parse(storedData); // Parse string to object
        if (parsedData.password === password) { // Check if stored password matches entered password
          // Successful login

          authContainer.style.display = 'none';      // Hide the login/registration container
          calendarContainer.style.display = 'block'; // Show the calendar container
          //Load user data from local storage
          userData = parsedData.userData; // Load user's calendar data
          init(); // Call the init function to render the calendar
        } else {
          loginError.textContent = 'שם משתמש או סיסמה שגויים'; // Display error message
        }
      } else {
        loginError.textContent = 'שם משתמש או סיסמה שגויים'; // Display error message if user not found
      }

    }

    // Add event listeners for form submissions
    registerForm.addEventListener('submit', handleRegistration); // Call handleRegistration function on registration form submission
    loginForm.addEventListener('submit', handleLogin); // Call handleLogin function on login form submission


    // Start of the script section

    let currentDate = new Date(); // Get the current date
    let userData = { names: ["אליס", "בוב", "צ'רלי"], calendarData: {} }; // Initialize user data

    // Function to get an array of 7 days starting from the current date
    function getWeekDates(startDate) {
      const weekDates = []; // Initialize an empty array to store the dates
      for (let i = 0; i < 7; i++) { // Loop 7 times to get 7 days
        const date = new Date(startDate); // Create a new Date object from the startDate
        date.setDate(startDate.getDate() + i); // Increment the date by i days
        weekDates.push(date); // Add the date to the array
      }
      return weekDates; // Return the array of dates
    }
    // Function to get an array of *8* days, and remove the first one.
    // Modified to return 14 days for two weeks
    function getTwoWeeks(startDate) {
      const twoWeekDates = []; // Initialize array
      for (let i = 0; i < 14; i++) { //loop 14 times for two weeks
        const date = new Date(startDate);  // Create a new date object
        date.setDate(startDate.getDate() + i); // Increment the date
        twoWeekDates.push(date); // Add date to array
      }
      return twoWeekDates; // Return array
    }

    // Function to format date as "Day, DD/MM"
    function formatDate(date) {
      const daysOfWeek = ['ראשון', 'שני', 'שלישי', 'רביעי', 'חמישי', 'שישי', 'שבת']; // Array of days in Hebrew
      const dayOfWeek = daysOfWeek[date.getDay()]; // Get the day of the week in Hebrew
      const dayOfMonth = date.getDate(); // Get the day of the month
      const month = date.getMonth() + 1; // Get the month (getMonth() is 0-indexed)
      return `${dayOfWeek}, ${dayOfMonth}/${month}`; // Return the formatted date string
    }

    // Function to update the  names array
    function updateNames() {
      const namesInput = document.getElementById('namesInput'); // Get the names input element
      const newNames = namesInput.value.split(',').map(name => name.trim()).filter(name => name !== ""); // Split string into array, trim whitespace, and remove empty strings

      if (newNames.length > 0) { // Check if there are any names after processing

        userData.names = newNames; // Update names
        saveUserData(); // Save data after update names.
        renderCalendar(); // Re-render the calendar with updated names
      }
      namesInput.value = userData.names.join(', '); // Update input with current names
    }

    // Function to save user data to localStorage
    function saveUserData() {
      const username = document.getElementById('loginUsername').value; // Get current username
      if (username) {
        const storedData = localStorage.getItem(username); // Get stored
        if (storedData) {
          const parsedData = JSON.parse(storedData);
          parsedData.userData = userData;
          localStorage.setItem(username, JSON.stringify(parsedData)); // Store user data
        }
      }
    }

    // Function to render the calendar
    function renderCalendar() {

      const calendar = document.getElementById('calendar'); // Get the calendar container element
      calendar.innerHTML = ''; // Clear the calendar
      const weekDates = getTwoWeeks(currentDate); // Get the array of 14 dates for the two weeks

      for (const date of weekDates) { // Loop through each date in the weekDates array
        const dateStr = date.toISOString().split('T')[0]; // Format date as YYYY-MM-DD
        const dayElement = document.createElement('div'); // Create a new div for the day
        dayElement.classList.add('day'); // Add the 'day' class to the div
        dayElement.innerHTML = `<div class="day-header">${formatDate(date)}</div>`; // Add the formatted date as the header

        const nameList = document.createElement('div'); // Create a div for the name list
        nameList.classList.add('name-list'); // Add the 'name-list' class

        let onBaseCount = 0; // Initialize on-base count
        let requestCount = 0; // Initialize request count
        let sickCount = 0; // Initialize sick count

        // Initialize dayData if it doesn't exist
        if (!userData.calendarData[dateStr]) {
          userData.calendarData[dateStr] = {};
          for (const name of userData.names) {
            userData.calendarData[dateStr][name] = 'on-base'; // Default status
          }
        }

        for (const name of userData.names) { // Iterate through the  names array
          const nameElement = document.createElement('span'); // Create a span for each name
          nameElement.classList.add('name'); // Add the 'name' class
          nameElement.textContent = name; // Set the name as text content

          // Set the initial class based on stored data
          const status = userData.calendarData[dateStr][name] || 'on-base'; // Get status, default to on-base
          nameElement.classList.add(status); // Add class for current status

          // Update the counts
          switch (status) {
            case 'on-base': onBaseCount++; break;
            case 'request': requestCount++; break;
            case 'sick': sickCount++; break;
          }

          nameElement.addEventListener('click', function() { // Add click event listener to toggle status
            let newStatus; // Variable to store the new status
            if (nameElement.classList.contains('on-base')) { // Check if current status is on-base
              nameElement.classList.remove('on-base'); // Remove on-base class
              nameElement.classList.add('request'); // Add request class
              newStatus = 'request'; // Set new status
              onBaseCount--; // Decrement on-base count
              requestCount++; // Increment request count
            } else if (nameElement.classList.contains('request')) { // Check if current status is request
              nameElement.classList.remove('request'); // Remove request class
              nameElement.classList.add('sick'); // Add sick class
              newStatus = 'sick'; // Set new status
              requestCount--; // Decrement request count
              sickCount++; // Increment sick count
            } else { // If not on-base or request, must be sick
              nameElement.classList.remove('sick'); // Remove sick class
              nameElement.classList.add('on-base'); // Add on-base class
              newStatus = 'on-base';
              sickCount--; // Decrement sick count
              onBaseCount++; // Increment on-base count
            }

            // Update the user data
            userData.calendarData[dateStr][name] = newStatus;
            saveUserData(); // Save data after update status

            updateTotals(dayElement, onBaseCount, requestCount, sickCount); // Update the totals for the day
          });

          nameList.appendChild(nameElement); // Append the name element to the name list
        }

        dayElement.appendChild(nameList); // Append the name list to the day element

        const totalsElement = document.createElement('div'); // Create a div for totals
        totalsElement.classList.add('totals'); // Add the 'totals' class
        totalsElement.textContent = `בבסיס: ${onBaseCount}, בקשה: ${requestCount}, חולה: ${sickCount}`; // Set initial totals text, translated to Hebrew

        dayElement.appendChild(totalsElement); // Append totals to the day element

        calendar.appendChild(dayElement); // Append the day element to the calendar
      }
    }

    // Function to update totals for a specific day
    function updateTotals(dayElement, onBaseCount, requestCount, sickCount) {
      const totalsElement = dayElement.querySelector('.totals'); // Find the totals element within the day
      totalsElement.textContent = `בבסיס: ${onBaseCount}, בקשה: ${requestCount}, חולה: ${sickCount}`; // Update the totals text, translated to Hebrew
    }

    // Function to advance to the next week
    function nextWeek() {
      currentDate.setDate(currentDate.getDate() + 7); // Increment current date by 7 days to get the next week.
      userData.calendarData = {}; // Reset
      renderCalendar(); // Re-render

    }

    // Initialize
    function init() {
      document.getElementById('namesInput').value = userData.names.join(', '); // Populate the names input with initial names
      // Set interval to advance to the next week every 7 day
      setInterval(nextWeek, 7 * 86400000); // 7 days * 24 hours * 60 minutes * 60 seconds * 1000 milliseconds
      renderCalendar(); // Initial render of the calendar
    }

  </script>
  <!-- End of the script section -->
</body>
<!-- End of the body section -->

</html>
